<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script>


        // array of json objects
        var classmate_data = [];

        function reprocessVampire() {
            var rows = document.getElementById("vampire_table").rows;
            for (var x = 1; x < rows.length; x++) {
                var row = rows[x];
                var studentId = parseInt(row.getAttribute("id"));
                var student;

                for (var y = 0; y < classmate_data.length; y++) {
                    student = classmate_data[y];
                    if (student.id === studentId) {
                        break;
                    }
                }

                var isVampire = isStudentAVampire(student.vampireScore);
                student.isVampire = isVampire;

                row.cells[1].innerHTML = isVampire ? "Vampire" : "Human";
            }
        }

        function insertStudentToTable(id, name, isVampire) {
            var table = document.getElementById("vampire_table");

            var row = table.insertRow(1);
            row.setAttribute("id", id);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            cell1.innerHTML = name;
            cell2.innerHTML = isVampire ? "Vampire" : "Human";
        }

        function isStudentAVampire(vampireScore) {
            var processing = parseInt(document.getElementById("mySelect").value);
            var isVampire = false;

            if (processing === 1) {
                isVampire = Math.floor(Math.random()*2) === 1;
            }
            else if (processing === 2) {
                isVampire = vampireScore > 0;
            }

            return isVampire;
        }

        function submitUserInput() {
            // name
            var name = document.getElementById("student_name").value;

            // shadow
            var shadow = document.getElementById("has_shadow").checked;

            // garlic
            var garlic = document.getElementById("garlic_checkbox").checked;

            // complexion
            var complexion = document.getElementById("complexion_slider").value;

            // accent
            var romanianAccent = parseInt(document.getElementById("accent_select").value) === 3;

            var vampireScore = 0;

            shadow ? vampireScore -= 5 : vampireScore += 5;
            garlic ? vampireScore -= 5 : vampireScore += 5;
            // Assume higher value means more pale
            complexion > 5 ? vampireScore += 5 : vampireScore -= 5;
            romanianAccent ? vampireScore += 5 : vampireScore -= 5;

            var isVampire = isStudentAVampire(vampireScore);

            var student = {
                id: classmate_data.length,
                name,
                shadow,
                garlic,
                complexion,
                romanianAccent,
                vampireScore,
                isVampire
            }

            classmate_data.push(student);
            insertStudentToTable(student.id, student.name, student.isVampire);
        }

        //Model  of MVC
        //TODO: create a function for random guess


        //TODO: create a function for threshold 
        function classmate_data_processing(result_data) {
            var num_human = 0;
            var num_vampire = 0;
            for (var i = 0; i <= classmate_data.length - 1; i++) {
                if (classmate_data[i]["shadow"] == "no") {
                    num_vampire++;
                } else {
                    num_human++;
                }
            }
            result_data.addColumn("string", "Element");
            result_data.addColumn("number", "Count");
            result_data.addRows([
                ["Human", num_human],
                ["Vampire", num_vampire],
            ]);
        }



        google.charts.load("current", { packages: ["corechart"] });

        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = new google.visualization.DataTable();

            //TODO: will need to come back and update to grab correct user input from drop down...maybe a condition?
            classmate_data_processing(data);

            var options = {
                title: "How many vampires in the class?",
                width: 400,
                height: 300,
            };

            var chart = new google.visualization.PieChart(
                document.getElementById("chart_div")
            );
            chart.draw(data, options);
        }



//Controller MVC 


//TODO: display method for new students into table

//TODO: upload method for new student into data
    </script>
    <title>Are you a Vampire?</title>
</head>

<body>

    <br>

    <div class="form-group">
        <label for="mySelect">Data preprocessing choice:</label>
        <select class="form-control" id="mySelect" onchange="reprocessVampire()">
            <option value='1'>Random Guess</option>
            <option value='2'>Threshold Based Method</option>
            <option value='3'>Decision Tree</option>
        </select>


        <!-- TODO: populate a table with new students added -->
        <div class="container">
            <table class="table table-bordered" id="vampire_table">
                <caption></caption>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Is Vampire</th>
                    </tr>
                </thead>
            </table>

            <div class="name">
                <div class="form-group col-md-12">
                    <h4>Student Name:</h4>
                    <input type="text" id="student_name"/>
                </div>
            </div>

            <div class="shadow">
                <div class="form-group col-md-12">
                    <h4>Do you have a shadow?</h4>
                    <div class="radio">
                        <label><input type="radio" name="optradio" id="has_shadow" checked />Yes</label>
                    </div>
                    <div class="radio">
                        <label><input type="radio" name="optradio" id="no_shadow" />No</label>
                    </div>
                </div>
            </div>
            <br>
            <div class="garlic">
                <div class="form-group col-md-12">
                    <h4>Do you like garlic?</h4>
                    <div class="checkbox">
                        <label><input type="checkbox" id="garlic_checkbox" />garlic toast</label>
                    </div>
                    <div class="checkbox">
                        <label><input type="checkbox" id="food_checkbox" />brownie</label>
                    </div>
                    <div class="checkbox">
                        <label><input type="checkbox" id="food_checkbox" />pancakes</label>
                    </div>
                    <div class="checkbox">
                        <label><input type="checkbox" id="food_checkbox" />fried chicken</label>
                    </div>
                    <div class="checkbox">
                        <label><input type="checkbox" id="food_checkbox" />canoli</label>
                    </div>
                </div>
            </div>


            <div class="slidecontainer">
                <div class="form-group col-md-12">
                    <h4>How pale are you?</h4>
                    <input type="range" min="0" max="10" value="5" class="slider" id="complexion_slider">
                    <span id="complexion_value">6</span>
                </div>
                <script>
                    var slider = document.getElementById("complexion_slider");
                    var output = document.getElementById("complexion_value");
                    output.innerHTML = slider.value; // Display the default slider value

                    // Update the current slider value (each time you drag the slider handle)
                    slider.oninput = function () {
                        output.innerHTML = this.value;
                    }
                </script>
            </div>


            <br>
            <div class="form-group">
                <div class="form-group col-md-12">
                    <h4>What about that accent?</h4>
                    <select class="accent" id="accent_select">
                        <option value='1'>German</option>
                        <option value='2'>English - UK</option>
                        <option value='3'>Romanian</option>
                        <option value='4'>Russian</option>
                        <option value='4'>Other</option>
                    </select>
                </div>
                <br>
                <br>

                <div class="form-group col-md-12">
                    <button type="button" onclick="submitUserInput()">Submit</button>
                </div>
</body>

</html>